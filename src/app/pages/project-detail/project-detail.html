<div class="project-detail-page">
  @if (loading()) {
    <div class="loading-state">
      <div class="loader"></div>
      <p>Loading project...</p>
    </div>
  } @else if (error()) {
    <section class="error-section section">
      <div class="container">
        <div class="error-state card">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="#ef4444"/>
          </svg>
          <h2>{{ error() }}</h2>
          <button (click)="goBack()" class="btn btn-primary">Back to Projects</button>
        </div>
      </div>
    </section>
  } @else if (project()) {
    <!-- Project Header -->
    <section class="project-header section">
      <div class="container">
        <button (click)="goBack()" class="back-button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 11H7.83L13.42 5.41L12 4L4 12L12 20L13.41 18.59L7.83 13H20V11Z" fill="currentColor"/>
          </svg>
          Back to Projects
        </button>
        
        <div class="header-content animate-fade-in-up">
          <div class="project-title-wrapper">
            <h1 class="project-name text-gradient">{{ project()!.name }}</h1>
            @if (project()!.ongoing) {
              <span class="badge badge-ongoing">Ongoing</span>
            }
          </div>
          <p class="project-role">{{ project()!.role }}</p>
          <p class="project-short-desc">{{ project()!.shortDescription }}</p>
          
          <div class="project-actions">
            @if (project()!.screenshots && project()!.screenshots.length > 0) {
              <button (click)="scrollToGallery()" class="btn btn-secondary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19ZM8.5 13.5L11 16.51L14.5 12L19 18H5L8.5 13.5Z" fill="currentColor"/>
                </svg>
                View Gallery
              </button>
            }
            @if (project()!.githubUrlFE) {
              <a [href]="project()!.githubUrlFE" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" fill="currentColor"/>
                </svg>
                View Frontend on GitHub
              </a>
            }
            @if (project()!.githubUrlBE) {
              <a [href]="project()!.githubUrlBE" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" fill="currentColor"/>
                </svg>
                View Backend on GitHub
              </a>
            }
            @if (project()!.liveUrl) {
              <div class="live-demo-wrapper">
                <a [href]="project()!.liveUrl" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM11 19.93C7.05 19.44 4 16.08 4 12C4 11.38 4.08 10.79 4.21 10.21L9 15V16C9 17.1 9.9 18 11 18V19.93ZM17.9 17.39C17.64 16.58 16.9 16 16 16H15V13C15 12.45 14.55 12 14 12H8V10H10C10.55 10 11 9.55 11 9V7H13C14.1 7 15 6.1 15 5V4.59C17.93 5.78 20 8.65 20 12C20 14.08 19.2 15.97 17.9 17.39Z" fill="currentColor"/>
                  </svg>
                  Live Demo
                </a>
                @if (project()!.demoCredentials && project()!.demoCredentials!.length > 0) {
                  <div class="credentials-inline" [class.expanded]="credentialsExpanded()">
                    <button class="credentials-toggle" (click)="toggleCredentials()">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 8H17V6C17 3.24 14.76 1 12 1C9.24 1 7 3.24 7 6V8H6C4.9 8 4 8.9 4 10V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V10C20 8.9 19.1 8 18 8ZM12 17C10.9 17 10 16.1 10 15C10 13.9 10.9 13 12 13C13.1 13 14 13.9 14 15C14 16.1 13.1 17 12 17ZM15.1 8H8.9V6C8.9 4.29 10.29 2.9 12 2.9C13.71 2.9 15.1 4.29 15.1 6V8Z" fill="currentColor"/>
                      </svg>
                      <span>Demo Credentials</span>
                      <svg class="chevron-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.41 8.59L12 13.17L16.59 8.59L18 10L12 16L6 10L7.41 8.59Z" fill="currentColor"/>
                      </svg>
                    </button>
                    @if (credentialsExpanded()) {
                      <div class="credentials-list">
                        @for (cred of project()!.demoCredentials; track cred.userType) {
                          <div class="credential-item">
                            <span class="credential-type">{{ cred.userType }}</span>
                            <span class="credential-detail"><strong>User:</strong> {{ cred.username }}</span>
                            <span class="credential-detail"><strong>Pass:</strong> {{ cred.password }}</span>
                          </div>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </section>

    <!-- Project Content -->
    <section class="project-content section-sm">
      <div class="container">
        <div class="content-grid">
          <!-- Main Content -->
          <div class="main-column">
            <div class="content-section card">
              <h2 class="section-heading">Project Overview</h2>
              <p class="project-full-desc">{{ project()!.fullDescription }}</p>
            </div>

            @if (project()!.challengesAndSolutions && project()!.challengesAndSolutions!.length > 0) {
              <div class="content-section card">
                <h2 class="section-heading">Challenges & Solutions</h2>
                <div class="challenges-list">
                  @for (item of project()!.challengesAndSolutions; track item.challenge) {
                    <div class="challenge-solution-block">
                      <div class="cs-section challenge">
                        <div class="cs-header">
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="#eab308"/>
                          </svg>
                          <h3>Challenge</h3>
                        </div>
                        <p>{{ item.challenge }}</p>
                      </div>
                      
                      <div class="cs-section solution">
                        <div class="cs-header">
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="#22c55e"/>
                          </svg>
                          <h3>Solution</h3>
                        </div>
                        <p>{{ item.solution }}</p>
                      </div>
                    </div>
                  }
                </div>
              </div>
            }

            @if (project()!.screenshots && project()!.screenshots.length > 0) {
              <div class="content-section" id="screenshots-section">
                <h2 class="section-heading">Screenshots</h2>
                <div class="screenshots-grid">
                  @for (screenshot of project()!.screenshots; track screenshot; let i = $index) {
                    <img 
                      [src]="getImageUrl(screenshot)" 
                      [alt]="project()!.name + ' screenshot'" 
                      class="screenshot"
                      (click)="openImage(screenshot, i)">
                  }
                </div>
              </div>
            }
          </div>

          <!-- Sidebar -->
          <div class="sidebar-column">
            <div class="sidebar-card card">
              <h3 class="sidebar-title">Technologies Used</h3>
              <div class="tech-badges">
                @for (tech of project()!.technologies; track tech) {
                  <span class="badge badge-primary">{{ tech }}</span>
                }
              </div>
            </div>

            <div class="sidebar-card card">
              <h3 class="sidebar-title">Project Links</h3>
              <div class="sidebar-links">
                @if (project()!.githubUrlFE) {
                  <a [href]="project()!.githubUrlFE" target="_blank" rel="noopener noreferrer" class="sidebar-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" fill="currentColor"/>
                    </svg>
                    View Frontend
                  </a>
                }
                @if (project()!.githubUrlBE) {
                  <a [href]="project()!.githubUrlBE" target="_blank" rel="noopener noreferrer" class="sidebar-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" fill="currentColor"/>
                    </svg>
                    View Backend
                  </a>
                }
                @if (project()!.liveUrl) {
                  <a [href]="project()!.liveUrl" target="_blank" rel="noopener noreferrer" class="sidebar-link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM11 19.93C7.05 19.44 4 16.08 4 12C4 11.38 4.08 10.79 4.21 10.21L9 15V16C9 17.1 9.9 18 11 18V19.93ZM17.9 17.39C17.64 16.58 16.9 16 16 16H15V13C15 12.45 14.55 12 14 12H8V10H10C10.55 10 11 9.55 11 9V7H13C14.1 7 15 6.1 15 5V4.59C17.93 5.78 20 8.65 20 12C20 14.08 19.2 15.97 17.9 17.39Z" fill="currentColor"/>
                    </svg>
                    Live Demo
                  </a>
                }
              </div>
            </div>

            @if (project()!.liveUrl && project()!.demoCredentials && project()!.demoCredentials!.length > 0) {
              <div class="sidebar-card card credentials-card" [class.expanded]="credentialsExpanded()">
                <button class="sidebar-credentials-toggle" (click)="toggleCredentials()">
                  <div class="toggle-left">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M18 8H17V6C17 3.24 14.76 1 12 1C9.24 1 7 3.24 7 6V8H6C4.9 8 4 8.9 4 10V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V10C20 8.9 19.1 8 18 8ZM12 17C10.9 17 10 16.1 10 15C10 13.9 10.9 13 12 13C13.1 13 14 13.9 14 15C14 16.1 13.1 17 12 17ZM15.1 8H8.9V6C8.9 4.29 10.29 2.9 12 2.9C13.71 2.9 15.1 4.29 15.1 6V8Z" fill="currentColor"/>
                    </svg>
                    <span>Demo Credentials</span>
                  </div>
                  <svg class="chevron-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7.41 8.59L12 13.17L16.59 8.59L18 10L12 16L6 10L7.41 8.59Z" fill="currentColor"/>
                  </svg>
                </button>
                @if (credentialsExpanded()) {
                  <div class="credentials-table">
                    <div class="credentials-table-header">
                      <span>User Type</span>
                      <span>Username</span>
                      <span>Password</span>
                    </div>
                    @for (cred of project()!.demoCredentials; track cred.userType) {
                      <div class="credentials-table-row">
                        <span class="user-type-badge">{{ cred.userType }}</span>
                        <span class="credential-value">{{ cred.username }}</span>
                        <span class="credential-value">{{ cred.password }}</span>
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </section>
  }

  <!-- Image Lightbox Modal -->
  @if (selectedImage()) {
    <div class="lightbox-overlay" (click)="closeImage()">
      <div class="lightbox-container" (click)="$event.stopPropagation()">
        <button class="lightbox-close" (click)="closeImage()" aria-label="Close">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
          </svg>
        </button>
        
        @if (project()!.screenshots.length > 1) {
          <button class="lightbox-nav lightbox-prev" (click)="previousImage()" aria-label="Previous image">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15.41 7.41L14 6L8 12L14 18L15.41 16.59L10.83 12L15.41 7.41Z" fill="currentColor"/>
            </svg>
          </button>
          
          <button class="lightbox-nav lightbox-next" (click)="nextImage()" aria-label="Next image">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.59 16.59L10 18L16 12L10 6L8.59 7.41L13.17 12L8.59 16.59Z" fill="currentColor"/>
            </svg>
          </button>
        }
        
        <img [src]="selectedImage()" [alt]="project()!.name + ' enlarged screenshot'" class="lightbox-image">
        
        <div class="lightbox-counter">
          {{ currentImageIndex() + 1 }} / {{ project()!.screenshots.length }}
        </div>
      </div>
    </div>
  }
</div>
